# Диспетчерская — интерактивный план завода

Веб-страница `DispetcherskayaMain.html` отображает схему завода с интерактивными областями. При наведении на причал или другой объект карта показывает карточку с судами, пришвартованными к этому месту, и дублирует их количеством иконок на самой области.

## Состав репозитория
- `DispetcherskayaMain.html` — основной файл интерфейса (HTML + встроенные CSS/JS).
- `interactiveAreas.json` — набор интерактивных областей с координатами.
- `yard_map.jpg` — изображение плана завода, которое подставляется в интерфейсе.
- `ship.png` — иконка судна для отображения на причалах.
- `dev-journal.md` — хронология ключевых изменений и решений.

## Формат входных данных о судах
Приложение ожидает массив объектов с минимум следующими полями:
- `причал` — идентификатор причала, по которому происходит сопоставление с областью.
- `судно` — название судна.
- `вид_подхода` *(опционально)* — текстовое описание подхода.
- `дата_швартовки` *(опционально)* — дата/время в формате `dd.mm.yyyy hh:mm:ss` или ISO.
- `дата_выбытия` *(опционально)* — дата/время в формате `dd.mm.yyyy hh:mm:ss` или ISO.

Пример JSON-массива:
```json
[
  {
    "причал": "причал №26",
    "судно": "баржа \"УДА\"",
    "вид_подхода": "самостоятельно",
    "дата_швартовки": "18.11.2025 16:10:00",
    "дата_выбытия": "19.11.2025 08:30:00"
  }
]
```

> В коде встроен парсер `parseManualDataString`, который умеет превращать полуструктурированные строки (без кавычек у ключей) в корректный JSON. При наличии готового JSON рекомендуется передавать его напрямую, чтобы избежать неоднозначностей.

## Формат интерактивных областей
`interactiveAreas.json` содержит массив объектов с обязательными полями:
- `name` *(string)* — отображаемое название области.
- `x`, `y`, `width`, `height` *(number)* — координаты и размеры области в пикселях исходной карты `yard_map.jpg`.
- `matchField` *(string)* — название поля, по которому ищется совпадение в данных (обычно `"причал"`).
- `matchValue` *(string, опционально)* — значение для сопоставления; если не указано, используется `name`.

Пример записи:
```json
{
  "name": "причал №26",
  "x": 1250,
  "y": 704,
  "width": 100,
  "height": 150,
  "matchField": "причал",
  "matchValue": "причал №26"
}
```

Координаты должны соответствовать исходному изображению: при масштабировании окна браузера области автоматически подгоняются под текущий размер карты.

## Настройка `DispetcherskayaMain.html`
В конце файла определены точки конфигурации:
- `const externalData = parseManualDataString("scriptData");` — замените `"scriptData"` на строку с данными или сразу на массив объектов: `const externalData = [...];`.
- `const interactiveAreasData = parseInteractiveAreasString("areasData");` — подставьте сюда содержимое `interactiveAreas.json` (строкой или массивом).
- `const mapImagePath = "C:/.../yard_map.jpg";` — укажите путь к схеме. Предпочтительнее относительный вариант `"yard_map.jpg"`, но поддерживаются и абсолютные пути Windows (переводятся в `file:///`).
- `const iconImagePath = "ship.png";` — путь к иконке судна.

По умолчанию карта и области берутся из переданных констант и не загружаются с сервера, поэтому важно вручную подставить актуальные значения перед публикацией.

## Запуск
1. Скопируйте карту (`yard_map.jpg`), иконку (`ship.png`), файл областей (`interactiveAreas.json`) и подготовленные данные в одну директорию с `DispetcherskayaMain.html`.
2. Обновите константы в конце `DispetcherskayaMain.html`, чтобы они ссылались на актуальные файлы/строки данных.
3. Запустите простой веб-сервер из этой папки (для обхода ограничений доступа к локальным файлам):
   ```bash
   python -m http.server 8000
   ```
4. Откройте `http://localhost:8000/DispetcherskayaMain.html` в браузере.

При открытии по протоколу `file://` абсолютные Windows-пути к изображениям автоматически конвертируются в `file:///`, но запуск через сервер остаётся предпочтительным из-за ограничений CORS.

## Дополнительные замечания
- Если в данных встречаются кавычки, используйте обратные кавычки (template literals) или экранирование (`\\`).
- Области, выходящие за границы изображения, подсвечиваются ошибками в консоли браузера.
- Историю изменений смотрите в `dev-journal.md`.
