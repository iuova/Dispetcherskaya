# Диспетчерская - Интерактивный план завода

## Описание

Веб-приложение для отображения карты завода с интерактивными областями. Позволяет навести курсор на объект и увидеть дополнительную информацию во всплывающем окне.

## Основные файлы проекта

- `DispetcherskayaMain.html` - основной файл интерфейса (HTML, CSS, JS).
- `interactiveAreas.json` - файл с описанием интерактивных областей для карты.
- `yard_map.jpg` - изображение плана завода.
- `dev-journal.md` - журнал разработки и событий проекта.

## Требования к `interactiveAreas.json`

Файл с интерактивными областями должен быть валидным JSON-массивом. Каждый элемент массива описывает отдельную область карты и должен содержать следующие поля:

- `name` *(string)* — произвольное название области для отображения во всплывающем окне.
- `x`, `y`, `width`, `height` *(number)* — координаты и размеры области на изображении карты в пикселях.
- `matchField` *(string)* — название поля в массиве данных, по которому будет выполняться поиск (например, `"причал"`, `"пирс"` или `"док"`).
- `matchValue` *(string)* — значение, которое должно существовать в указанном поле. Если не задано, в интерфейсе используется `name`, но для корректного сопоставления рекомендуется указывать явное значение.

Пример корректной записи:

```json
[
  {
    "name": "причал №26",
    "x": 288.7,
    "y": 194.9,
    "width": 48,
    "height": 12,
    "matchField": "причал",
    "matchValue": "причал №26"
  }
]
```

Обратите внимание, что значения в `matchField` и `matchValue` чувствительны к регистру и пробелам — они должны точно совпадать с ключами и значениями во входных данных.

## Проверка интерактивных областей

Для автоматической проверки того, что каждое `matchValue` присутствует в загружаемых данных, используйте утилиту `scripts/validateAreas.js`:

```
node scripts/validateAreas.js --data path/to/data.json --areas interactiveAreas.json
```

- `--data` (`-d`) — путь к JSON-файлу с массивом объектов, которые выводятся во всплывающем окне.
- `--areas` (`-a`) — путь к файлу интерактивных областей (по умолчанию `interactiveAreas.json`).

Скрипт выводит предупреждения для всех областей, у которых не найдено соответствующих записей в данных, что удобно для проверки в CI/CD.

## Быстрый старт

1. Склонируйте репозиторий или скачайте проект.
2. Поместите актуальную схему завода в `yard_map.jpg`.
3. Определите в `interactiveAreas.json` области (координаты и привязку к объектам).
4. В файле `DispetcherskayaMain.html` задайте пути к своим ресурсам и данным:
    - `mapImagePath` — путь к изображению карты (лучше указывать относительный путь `"yard_map.jpg"`).
    - `iconImagePath` — путь к иконке судна (по умолчанию `ship.png`).
    - `interactiveAreasData` — массив интерактивных областей или строка с их описанием (см. раздел выше). В шаблоне используется значение `"areasData"`, его нужно заменить на ваши данные или JSON.
    - `externalData` — массив объектов с данными для всплывающих окон. В шаблоне использовано значение `"scriptData"`, замените его на фактические данные или JSON-строку.
5. Откройте файл `DispetcherskayaMain.html` в браузере.
    - Для корректной работы загрузки данных с локального диска рекомендуется запускать через локальный веб-сервер:

        python -m http.server
              или использовать расширение Live Server для VS Code.

## Формат данных для всплывающих окон

`externalData` должен содержать массив объектов. Минимально достаточно полей `причал` (или иного поля, указанного в `matchField` области) и `судно`. Остальные поля необязательны:

```json
[
  {
    "судно": "Баржа УДА",
    "причал": "причал №26",
    "вид_подхода": "самостоятельно",
    "дата_швартовки": "03.04.2024 08:00:00",
    "дата_выбытия": "04.04.2024 12:00:00"
  }
]
```

- `причал` (или другое поле, указанное в `matchField`) используется для сопоставления с интерактивной областью через `matchValue`.
- `судно` выводится в заголовке карточки.
- `вид_подхода`, `дата_швартовки`, `дата_выбытия` отображаются при наличии; даты автоматически форматируются в виде `дд.мм.гггг чч:мм`.

## Примечания

- Все пути к файлам можно указать относительными (рекомендуется для кросс-платформенной работы).
- Для корректной работы интерактивных областей и данных используйте UTF-8.
- Журнал событий и изменений ведётся в `dev-journal.md`.
